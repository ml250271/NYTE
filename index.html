<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  <title>NYTE</title>
  <style type="text/css">
  </style>
</head>

<body>

  <div id="root"></div>


  <script type="text/babel">



    class Input extends React.Component{

      constructor(props){
            super(props);
            this.state = {date:[]}

          this.setMonth = this.setMonth.bind(this);
          // this.setYear = this.setYear.bind(this);


      }

      searchByMY() {
        const date = this.state.date;
        this.props.fetchArticles(date);
      }

        setMonth(e){
            let date = e.target.value.split("-");
            date = date.map( date => Math.abs(date) ).join("/");
            console.log(date);
            this.setState({date: date})
        }

        // setYear(e){
        //     this.setState({year: e.target.value})
        // }

      render(){
        return(
          <div>
            <h1>NYTE</h1>

            <label>Search month:</label>
            <input type="month" id="month" onChange={e => this.setMonth(e)}/>

            {/*<span>Search year:</span>*/}
            {/* <input type="year" id="year" onChange={e => this.setYear(e)}> */}

            <input type="button" id="find" value="Find" onClick={this.searchByMY.bind(this)}/>
      </div>

    )}}

    class ShowResult extends React.Component{

      constructor(props){
        super(props);
        this.setResult = this.setResult.bind(this);

        this.state = {
          description: "",
          image: "",
          title: "",
          url: ""
        }
      }

      setResult(result){

        this.setState({
          description: result.description,
          image: result.image,
          title: result.title,
          url: result.url
        })
      }

      componentDidMount(){
        $.ajax({
              url: `http://api.linkpreview.net/?key=5a9168704988539b8faaf928ad46f59df7c4ca9ae0dce&q=${this.props.url}`,
              method: 'GET',
            }).done((result)=> {
                this.setResult(result);

            }).fail(function(err) {
              throw err;
            });
      }

      render(){
        return(
          <div>
          <p>{this.state.title}</p>
          <p><img src={this.state.image} width="100"/></p>
          <p>{this.state.description}</p>
          <p>{this.state.url}</p>
        {/*} <p>
        //     <a href={this.props.url}>{this.props.url}</a>
        // </p>*/}
          </div>
        )


      }
    }

    class Detail extends React.Component{
          render(){
            return(
              <div>
                Details:
              </div>
            )

          }




    }

    class Result extends React.Component{

          constructor(props){
            super(props);
            this.state = {articles:[]}
            this.fetchArticles = this.fetchArticles.bind(this);
          }


          fetchArticles(date){

            var url = `https://api.nytimes.com/svc/archive/v1/${date}.json`;
            url += '?' + $.param({
              'api-key': "32e84cd913b6451bb47730dea03e2515"
            });
            console.log(url);
            $.ajax({
              url: url,
              method: 'GET',
            }).done(
              (result)=> {
                let items = [];
                for(var i = 0; i < 20; i++){
                  const item = result.response.docs[i];
                  items.push(item.web_url);
                }
              this.setState({
                articles: items
              });
            console.log(this.state);}
            ).fail(function(err) {
              throw err;
            });
          }


            render(){
            return (
              <div>
                <Input fetchArticles={this.fetchArticles}/>
                <div>
                  {
                    this.state.articles.map((url, index) =>
                      <ShowResult key={index} url={url}/>
                    )
                  }
                </div>
              </div>
            )
          }
    }


    const root = document.getElementById('root');
    ReactDOM.render(<Result/>, root);

    </script>
</body>

</html>