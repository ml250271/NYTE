<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  <title>NYTE</title>
  <style type="text/css">
  </style>
</head>

<body>

  <div id="root"></div>


  <script type="text/babel">



    class Input extends React.Component{

      constructor(props){
            super(props);
            this.state = {month:[],
                          year: []}
          
          this.setMonth = this.setMonth.bind(this);
          this.setYear = this.setYear.bind(this);


      }

      searchByMY() {
        const {year, month} = this.state;
        this.props.fetchArticles(year, month);
      }
        
        setMonth(e){
            this.setState({month: e.target.value})
        }
        
        setYear(e){
            this.setState({year: e.target.value})
        }

      render(){
        return(
          <div>
            <h1>NYTE</h1>

            <span>Search month:</span>
            <input type="text" id="month" onChange={e => this.setMonth(e)}/>

            <span>Search year:</span>
            <input type="text" id="year" onChange={e => this.setYear(e)}/>

            <input type="button" id="find" value="Find" onClick={this.searchByMY.bind(this)}/>
      </div>

    )}}

    class Result extends React.Component{

          constructor(props){
            super(props);
            this.state = {articles:[]}
            this.fetchArticles = this.fetchArticles.bind(this);
          }

          
          fetchArticles(year, month){

            var url = `https://api.nytimes.com/svc/archive/v1/2016/1.json`;
            url += '?' + $.param({
              'api-key': "32e84cd913b6451bb47730dea03e2515"
            });
            $.ajax({
              url: url,
              method: 'GET',
            }).done(
              (result)=> {
                let items = [];
                for(var i = 0; i < 20; i++){
                  const item = result.response.docs[i];
                  items.push(item.web_url);
                }
              this.setState({
                articles: items
              });
            console.log(this.state);}
            ).fail(function(err) {
              throw err;
            });
          }
                    
                    
            render(){
            return (
              <div>
                <Input fetchArticles={this.fetchArticles}/>
                <div>
                  {
                    this.state.articles.map((url, index) =>
                      <p key={index}>
                        <a href={url}>{url}</a>
                      </p>
                    )
                  }
                </div>
              </div>
            )
          }
    }


    const root = document.getElementById('root');
    ReactDOM.render(<Result/>, root);

    </script>
</body>

</html>